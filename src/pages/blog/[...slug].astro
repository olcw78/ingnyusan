---
import { CollectionEntry, getCollection } from "astro:content";
import BlogPost from "../../layouts/BlogPost.astro";
import { groq, useSanityClient } from "astro-sanity";
import { Blog } from "../../types";

export async function getStaticPaths() {
  const query = groq`
      *[_type == "blog"] {
        title,
        slug,
        publishedAt,
        isPrivate,
        password,
        categories,
        content,
      }`;

  const responses = await useSanityClient().fetch<Blog[]>(query);
  return responses.map((blog) => ({
    params: { slug: blog.slug.current },
    props: {
      blog: {
        ...blog,
        content: blog.content.flatMap(({ children }) =>
          children.map((e) => ({
            type: e._type,
            text: e.text,
          }))
        ),
      },
    },
  }));
}

const blog = Astro.props;
---

<BlogPost {...blog} />
